# Apache .htaccess for goyard-demenagement.fr
# This file goes in the DOCUMENT ROOT (e.g. ~/public_html/ or ~/goyard-demenagement.fr/)
# alongside the frontend dist/ contents (index.html, assets/, etc.)

# ─── HTTPS redirect ───
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>

# ─── Passenger (Django WSGI via Apache) ───
# Adjust the paths below to match your server:
#   PassengerAppRoot  = where passenger_wsgi.py lives (backend directory)
#   PassengerPython   = path to the Python binary (virtualenv or system)
<IfModule mod_passenger.c>
    PassengerEnabled On
    PassengerAppRoot /home/uid332672/GOYARD/backend
    PassengerAppType wsgi
    PassengerStartupFile passenger_wsgi.py
    # Uncomment and adjust if using a virtualenv:
    # PassengerPython /home/uid332672/virtualenv/GOYARD/3.11/bin/python
</IfModule>

# ─── Routing ───
<IfModule mod_rewrite.c>
    RewriteEngine On

    # 1) If the requested file or directory exists, serve it directly
    #    (this serves index.html, assets/*, images, etc. from dist/)
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # 2) API, admin, swagger, static, media → fall through to Passenger → Django
    RewriteCond %{REQUEST_URI} ^/api/ [OR]
    RewriteCond %{REQUEST_URI} ^/admin/ [OR]
    RewriteCond %{REQUEST_URI} ^/swagger/ [OR]
    RewriteCond %{REQUEST_URI} ^/redoc/ [OR]
    RewriteCond %{REQUEST_URI} ^/static/ [OR]
    RewriteCond %{REQUEST_URI} ^/media/
    RewriteRule ^ - [L]

    # 3) SPA catch-all: everything else → index.html (React Router handles it)
    RewriteRule ^ index.html [L]
</IfModule>

# ─── Security: block sensitive files ───
<FilesMatch "\.(env|pyc|py|sh|sqlite3|log)$">
    Require all denied
</FilesMatch>
<Files "passenger_wsgi.py">
    Require all denied
</Files>
<Files ".htaccess">
    Require all denied
</Files>

# ─── Caching for frontend assets ───
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/html "access plus 0 seconds"
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
</IfModule>
