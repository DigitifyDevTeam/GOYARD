# Apache .htaccess for goyard-demenagement.fr
# This file goes in the DOCUMENT ROOT (e.g. ~/public_html/ or ~/goyard-demenagement.fr/)
# alongside the frontend dist/ contents (index.html, assets/, etc.)

# ─── HTTPS redirect ───
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>

# ─── Reverse proxy: send /api, /admin, /static, /media to Gunicorn (port 8002) ───
# Requires: mod_proxy, mod_proxy_http, mod_rewrite. If you get 500, ask host to enable "AllowOverride" for proxy or add ProxyPass in vhost.
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_URI} ^/(api|admin|static|media|swagger|redoc)/
    RewriteRule ^(.*)$ http://127.0.0.1:8002/$1 [P,L]
</IfModule>

# ─── Routing (static files + SPA) ───
<IfModule mod_rewrite.c>
    RewriteEngine On

    # 1) If the requested file or directory exists, serve it directly (frontend dist/)
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # 2) SPA catch-all: everything else → index.html (React Router)
    RewriteRule ^ index.html [L]
</IfModule>

# ─── Security: block sensitive files ───
<FilesMatch "\.(env|pyc|py|sh|sqlite3|log)$">
    Require all denied
</FilesMatch>
<Files "passenger_wsgi.py">
    Require all denied
</Files>
<Files ".htaccess">
    Require all denied
</Files>

# ─── Caching for frontend assets ───
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/html "access plus 0 seconds"
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
</IfModule>
